<div class="container-lg">
    <div class="admin-container-content">
        <header class="admin-container-content-header">
            <h1 class="row py-4 text-primary admin-container-content-header__title">
                Book
            </h1>
        </header>

        <div class="row justify-content-end">
            <div class="col-sm-4 text-center">
                <a href="/table/book/{{book.id}}/delete">
                    <button type="submit" class="btn btn-success shadow-none">
                        <i class="fa fa-trash"></i>
                        Delete
                    </button>
                </a>
            </div>
        </div>

        <form action="/table/book/{{book.id}}/action" enctype="multipart/form-data" method="post">
            <div class="">
            </div>

            <div class="">
                <div class="row justify-content-center">
                    <h2 class="row py-4 text-secondary">
                        Book {{book.id}}
                    </h2>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-lg-3 py-2">
                                ISBN
                            </div>
                            <div class="col-lg-9 py-2">
                                <input class="form-control" name="isbn" type="text" placeholder="isbn"
                                       value="{{book.isbn}}"
                                >
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-lg-3 py-2">
                                Title
                            </div>
                            <div class="col-lg-9 py-2">
                                <input class="form-control" name="title" type="text" placeholder="title"
                                       value="{{book.title}}"
                                >
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-lg-3 py-2">
                                Number of pages
                            </div>
                            <div class="col-lg-9 py-2">
                                <input class="form-control" name="num_page" type="number" step="1" min="0"
                                       placeholder="num_page" value="{{book.num_page}}"
                                >
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-lg-3 py-2">
                                Publication date
                            </div>
                            <div class="col-lg-9 py-2">
                                <input class="form-control" name="publication_date" placeholder="publication date"
                                       value="{{book.publication_date}}">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-lg-3 py-2">
                                Price
                            </div>
                            <div class="col-lg-9 py-2">
                                <input class="form-control" name="price" type="number" step="1" min="0"
                                       placeholder="price" value="{{book.price}}"
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <div class="">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="row align-items-center">
                                <div class="col-lg-3 py-2">
                                    Publisher
                                </div>
                                <div class="col-lg-9 py-2">
                                    <div class="input-group">
                                        <input list="publisherList" id="publisherIp" type="text" class="form-control"
                                               name="publisher" value="{{book.publisher.name}}">
                                        <datalist id="publisherList">
                                            {{#each allPublisher}}
                                                <option value="{{name}}"></option>
                                            {{/each}}
                                        </datalist>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--                    <div class="row justify-content-center">-->
                    <!--                    <div class="col-lg-8">-->
                    <!--                        <div class="row align-items-center">-->
                    <!--                            <div class="col-lg-3 py-2">-->
                    <!--                                Author-->
                    <!--                            </div>-->
                    <!--                            <div class="col-lg-9 py-2">-->
                    <!--                                <div class="input-group">-->
                    <!--                                    <input list="authorList" id="authorIp" type="text" class="form-control" name="author" value="{{book.author}}">-->
                    <!--                                    <datalist id="authorList">-->
                        <!--                                        {{#each allAuthor}}-->
                    <!--                                            <option value="{{name}}"></option>-->
                        <!--                                        {{/each}}-->
                    <!--                                    </datalist>-->
                    <!--                                </div>-->
                    <!--                                <div class="row justify-content-end">-->
                    <!--                                    <div class="col-xl-4 col-md-12">-->
                    <!--                                        <button id="addNewAuthorBtn" type="button"-->
                    <!--                                                class="btn btn-success rounded-circle">-->
                    <!--                                            <i class="fa-solid fa-plus"></i>-->
                    <!--                                        </button>-->
                    <!--                                </div>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                </div>-->

                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="row align-items-center">
                                <div class="col-lg-3 py-2">
                                    Category
                                </div>
                                <div class="col-lg-9 py-2">
                                    <div class="input-group">
                                        <input list="categoryList" id="categoryIp" type="text" class="form-control"
                                               name="category" value="{{book.category}}">
                                        <datalist id="categoryList">
                                            {{#each allCategory}}
                                                <option value="{{name}}"></option>
                                            {{/each}}
                                        </datalist>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--                    <div class="row justify-content-center">-->
                    <!--                        <div class="col-lg-8">-->
                    <!--                            <div class="row align-items-center">-->
                    <!--                                <h4 class="row py-4 text-secondary">-->
                    <!--                                    Images-->
                    <!--                                </h4>-->

                    <!--                                <div class="row justify-content-start mt-4 add-new-pictures">-->
                    <!--                                    <input name="image" accept="image/*" type='file' id="imageInput" multiple/>-->
                    <!--                                </div>-->
                    <!--                                <div class="mt-4 p-1" style="border-radius: 10px; border: 1px solid #ccc; ">-->
                    <!--                                    <div class="row justify-content-start mt-4 none" id="showAddedImage"></div>-->
                    <!--                                </div>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                </div>

                <div class="" id="pictureList">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="row align-items-center">
                                <h4 class="row py-4 text-secondary">
                                    Images
                                </h4>

                                <div class="row justify-content-start mt-4 add-new-pictures">
                                    <input name="pictures" accept="image/*" type='file' id="imageInput" multiple>
                                </div>
                                <div class="mt-4 p-1" style="border-radius: 10px; border: 1px solid #ccc; ">
                                    <div class="row justify-content-start mt-4 none" id="showAddedImage"></div>
                                </div>
                            </div>
                            <p>Số lượng ảnh xóa: <span id="countDeletePictures"></span></p>

                            <div class="mt-4 p-1" style="border-radius: 10px; border: 1px solid #ccc; ">
                                <div class="row justify-content-start mt-4">
                                    {{#each book.image}}
                                        <div class="col-lg-1 col-md-3 col-sm-6 mb-4 product-picture">
                                            <input type="hidden" id="deletePictureInput" value="{{id}}">
                                            <input type="hidden" id="deletePictureLinkInput" value="{{src}}">
                                            <img src="{{src}}" class="product-picture-img" style="width: 80%"/>
                                        </div>
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <div class="">
                <div class="row justify-content-center">
                    <div class="col-sm-4 text-center">
                        <button type="submit" class="btn btn-success shadow-none">
                            <i class="fa fa-pencil"></i>
                            Save changes
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

{{#section 'script'}}

    <script>
        $('#imageInput').change(function (e) {
            // console.log("URL.createObjectURL: ", URL.createObjectURL(e.target.files[0]))
            let showAddedImageHtml = "";
            for (let file of e.target.files) {
                const src = URL.createObjectURL(file);
                showAddedImageHtml +=
                        `<div class="col-lg-1 col-md-3 col-sm-6 mb-4 addedImage">
                            <img src="${src}" alt="new product image" style="width: 80%"/>
                        </div>`
            }
            $("#showAddedImage").append(showAddedImageHtml);
        });


        let countDeletePictures = 0;
        $("#pictureList").on('click', '.product-picture-img', function (e) {
            console.log("picture click");
            const img = $(e.target).closest("img");
            const deletePictureInput = img.closest(".product-picture").find("#deletePictureInput");
            const deletePictureLinkInput = img.closest(".product-picture").find("#deletePictureLinkInput");
            const id = img.closest(".product-picture").find("input").val();
            console.log("id: ", id);
            console.log(img);
            if (parseFloat(img.css("opacity")) < 1) {
                img.css('opacity', '1');
                countDeletePictures--;
                $("#countDeletePictures").html(countDeletePictures);
                deletePictureInput.removeAttr('name');
                deletePictureLinkInput.removeAttr('name');
            } else {
                img.css('opacity', '0.6');
                countDeletePictures++;
                $("#countDeletePictures").html(countDeletePictures);
                deletePictureInput.attr('name', 'deletePictures[]');
                deletePictureLinkInput.attr('name', 'deletePictureLinks[]');
            }
        })

    </script>

{{/section}}